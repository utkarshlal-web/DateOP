<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OP Dashboard</title>
  <style>
    :root{
      --ink:#1f2937; --muted:#6b7280;
      --accent:#2563eb; --border: rgba(15, 23, 42, .15);
      --backdrop: rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}

    /* ðŸŒ¿ Panda landscape background */
    body{
      margin:0;
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background: linear-gradient(to top, #a8e6a1 0%, #d6f5d6 50%, #f5fff5 100%);
      background-attachment: fixed;
    }
    body::before {
      content: "";
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 200px;
      background: radial-gradient(circle at 20% 100%, #6fbf73 200px, transparent 201px),
                  radial-gradient(circle at 80% 100%, #7fcf85 200px, transparent 201px);
      background-repeat: no-repeat;
      background-size: 50% 100%, 50% 100%;
      z-index: -2;
    }
    body::after {
      content: "";
      position: fixed;
      bottom: 20px; right: 20px;
      width: 120px; height: 120px;
      background: url('https://upload.wikimedia.org/wikipedia/commons/0/0f/Giant_Panda_vector.svg') no-repeat center/contain;
      opacity: 0.9;
      z-index: -1;
    }

    /* Glassmorphism look */
    .glass{
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(12px) saturate(160%);
      -webkit-backdrop-filter: blur(12px) saturate(160%);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 24px rgba(2,8,23,.12);
    }

    header{padding:16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    h1{margin:0;font-size:24px;font-weight:800}
    header p{margin:0;color:var(--muted);flex:1 1 100%}
    .top-actions{margin-left:auto;display:flex;gap:8px}
    .btn{background:var(--accent);border:none;color:#fff;border-radius:10px;padding:9px 12px;font-weight:700;cursor:pointer}
    .btn.ghost{background:rgba(255,255,255,0.7);color:#111827;border:1px solid var(--border)}

    .wrap{padding:0 16px 20px; max-width:1100px; margin:0 auto}
    .list{display:grid;grid-template-columns:repeat(2,minmax(280px,1fr));gap:14px}
    @media (max-width:900px){.list{grid-template-columns:1fr}}

    .card{padding:16px;display:flex;gap:10px;flex-direction:column}
    .card h3{margin:0 0 6px;font-size:18px}
    .k{color:var(--muted)}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px}
    .badge{background:rgba(255,255,255,0.6);border:1px solid var(--border);color:#374151;padding:4px 8px;border-radius:999px;font-size:12px}
    .cta{margin-top:6px;display:flex;gap:8px;flex-wrap:wrap}
    a.inline{color:#1d4ed8;text-decoration:none}

    /* Single mobile/desktop drawer for filters */
    .drawer-back{display:none}
    .drawer{position:fixed;left:0;right:0;top:0;background:rgba(255,255,255,0.8);
            border-bottom:1px solid var(--border); border-radius:0 0 16px 16px; padding:12px;
            box-shadow:0 12px 32px rgba(2,8,23,.2); transform:translateY(-110%); transition:transform .25s ease; z-index:21}
    .drawer.show{transform:translateY(0)}
    .drawer-back.show{position:fixed;inset:0;background:var(--backdrop);display:block;z-index:20}
    .filters{display:grid;gap:10px}
    .field{background:rgba(255,255,255,0.55);border:1px solid var(--border);border-radius:12px;padding:10px}
    .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    .field select,.field input[type="text"]{
      width:100%;background:#f8fafc;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:10px
    }
    .toggle{display:flex;align-items:center;gap:8px;font-size:14px;color:#111827}
    .toggle input{transform:scale(1.1)}
    .drawer .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

    /* Popover */
    .popover{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--backdrop);z-index:30}
    .popover.show{display:flex}
    .sheet{background:rgba(255,255,255,0.85);backdrop-filter: blur(10px);border:1px solid var(--border);border-radius:16px;padding:16px;max-width:520px;width:92%}
    .sheet h4{margin:0 0 8px}
    .row{display:flex;gap:10px;align-items:center;margin:8px 0}
    .row input[type="text"]{flex:1;background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:8px}
  </style>
</head>
<body>
  <header class="glass">
    <h1>OP Dashboard</h1>
    <p><em>I figure you're familiar with dashboards, so this should be easy! Would you like to go out with me?</em></p>
    <div class="top-actions">
      <button id="openDrawer" class="btn">Filters <span id="activeCount" style="font-weight:600;"></span></button>
      <button id="copyLink" class="btn ghost">Copy filter link</button>
    </div>
  </header>

  <div class="wrap">
    <main>
      <div id="list" class="list"></div>
    </main>
  </div>

  <!-- Single Filters Drawer -->
  <div class="drawer-back" id="drawerBack"></div>
  <div class="drawer glass" id="drawer">
    <div class="filters" id="filters"></div>
    <div class="actions">
      <button class="btn" id="applyDrawer">Apply</button>
      <button class="btn ghost" id="closeDrawer">Close</button>
      <button class="btn ghost" id="reset">Reset</button>
    </div>
  </div>

  <!-- Confirm popover -->
  <div id="pop" class="popover">
    <div class="sheet">
      <h4 id="pop-title">Confirm your pick</h4>
      <div class="row"><input type="checkbox" id="withMeal" /><label for="withMeal">With meal</label></div>
      <div class="row"><input id="customPlan" type="text" placeholder="Add a note or your own plan (optional)"/></div>
      <div class="actions">
        <button class="btn" id="copyChoice">Copy link</button>
        <button class="btn ghost" id="waChoice">WhatsApp</button>
        <button class="btn ghost" id="cancelPop">Cancel</button>
      </div>
    </div>
  </div>

<script>
// ---------- Owner contact ----------
const OWNER_PHONE = '919838006777'; // WhatsApp number only

// ---------- Plans ----------
const PLANS = [
  {
    id:'begum',
    title:'Badass Begum: Women & Architecture in Old Delhi',
    subtitle:'Heritage walk',
    type:'Culture',
    url:'https://www.district.in/events/badass-begum-women-architecture-in-old-delhi-aug30-2025-buy-tickets',
    venue:'Old Delhi',location:'Central',
    days:['Saturday','Weekend'],times:['Morning'],
    commitment:'3â€“4 hrs'
  },
  {
    id:'siri',
    title:'Badminton / Pickleball at Siri Fort',
    subtitle:'Court session',
    type:'Sport',
    url:'#',
    venue:'Siri Fort Sports Complex',location:'South',
    days:['Weekday','Weekend'],times:['Morning','Evening'],
    commitment:'2â€“3 hrs'
  },
  {
    id:'sloss',
    title:'Daniel Sloss: The New Show',
    subtitle:'Stand-up (BookMyShow)',
    type:'Comedy',
    url:'https://in.bookmyshow.com',
    venue:'South Delhi (see BMS for exact venue)',location:'South',
    days:['Weekday','Weekend'],times:['Evening','Night'],
    commitment:'3â€“4 hrs'
  },
  {
    id:'karaoke',
    title:'Karaoke @ Garage Delhi',
    subtitle:'Tue / Thu nights',
    type:'Music',
    url:'https://www.instagram.com/garageinc.delhi/?hl=en',
    venue:'Garage Delhi',location:'Central',
    days:['Tuesday','Thursday','Weekday'],times:['Evening','Night'],
    commitment:'3â€“4 hrs'
  },
  {
    id:'openmic',
    title:'Saturday Open Mic â€“ Comedy â€¢ Poetry â€¢ Storytelling â€¢ Music',
    subtitle:'District.in',
    type:'Open Mic',
    url:'https://www.district.in/events/comedy-poetry-storytelling-music-saturday-open-mic-delhi-nov30-2024-buy-tickets',
    venue:'Delhi',location:'Central',
    days:['Saturday','Weekend'],times:['Evening'],
    commitment:'3â€“4 hrs'
  },
  {
    id:'escapecp',
    title:'Escape Room â€“ The Hidden Hour (Connaught Place)',
    subtitle:'Solve clues, beat the clock',
    type:'Game',
    url:'https://www.thehiddenhour.com/delhi/connaught-place',
    venue:'Connaught Place',location:'Central',
    days:['Weekday','Weekend'],times:['Afternoon','Evening'],
    commitment:'2â€“3 hrs'
  },
  {
    id:'escapesouth',
    title:'Escape Room â€“ The Hidden Hour (South Delhi)',
    subtitle:'Pick a theme & crack codes',
    type:'Game',
    url:'https://www.thehiddenhour.com/delhi/connaught-place', /* replace if you have a distinct south link */
    venue:'South Delhi',location:'South',
    days:['Weekday','Weekend'],times:['Afternoon','Evening'],
    commitment:'2â€“3 hrs'
  }
];

const OWN_ID='ownplan'; const NI_ID='notinterested';
  // ---------- URL state ----------
const params = new URLSearchParams(location.search);
const state = {
  q: params.get('q') || '',
  loc: params.get('loc') || '',
  day: params.get('day') || '',
  time: params.get('time') || '',
  commit: params.get('commit') || '',
  type: params.get('type') || '',
  disabled: params.get('nofilters') === '1', // disable filters
  plan: params.get('plan') || '',
  meal: params.get('meal') || '',
  own: params.get('own') || ''
};

function setParam(k,v){
  const p = new URLSearchParams(location.search);
  if(v || v===0) p.set(k,v); else p.delete(k);
  const url = `${location.pathname}?${p.toString()}`;
  history.replaceState(null,'', url.endsWith('?')?url.slice(0,-1):url);
}

// ---------- Build single filter form ----------
function filterFormHTML(){
  return `
    <div class="field">
      <label for="q">Search</label>
      <input id="q" type="text" placeholder="Search title, venueâ€¦" />
    </div>
    <div class="field">
      <label for="loc">Location</label>
      <select id="loc">
        <option value="">Any</option>
        <option value="South">South</option>
        <option value="Central">Central</option>
        <option value="North">North</option>
      </select>
    </div>
    <div class="field">
      <label for="day">Day</label>
      <select id="day">
        <option value="">Any</option>
        <option>Weekday</option>
        <option>Weekend</option>
        <option>Tuesday</option>
        <option>Thursday</option>
        <option>Saturday</option>
      </select>
    </div>
    <div class="field">
      <label for="time">Time of day</label>
      <select id="time">
        <option value="">Any</option>
        <option>Morning</option>
        <option>Afternoon</option>
        <option>Evening</option>
        <option>Night</option>
      </select>
    </div>
    <div class="field">
      <label for="commit">Time commitment</label>
      <select id="commit">
        <option value="">Any</option>
        <option>2â€“3 hrs</option>
        <option>3â€“4 hrs</option>
        <option>Half-day</option>
      </select>
    </div>
    <div class="field">
      <label for="type">Type</label>
      <select id="type">
        <option value="">Any</option>
        <option>Culture</option>
        <option>Sport</option>
        <option>Comedy</option>
        <option>Music</option>
        <option>Open Mic</option>
        <option>Game</option>
      </select>
    </div>
    <div class="field toggle">
      <input id="disable" type="checkbox" />
      <label for="disable">Disable filters</label>
    </div>
  `;
}
document.getElementById('filters').innerHTML = filterFormHTML();

function syncControls(){
  document.getElementById('q').value = state.q;
  document.getElementById('loc').value = state.loc;
  document.getElementById('day').value = state.day;
  document.getElementById('time').value = state.time;
  document.getElementById('commit').value = state.commit;
  document.getElementById('type').value = state.type;
  document.getElementById('disable').checked = state.disabled;
}

function bindFilterEvents(){
  const on = (id, ev, cb)=>document.getElementById(id).addEventListener(ev, cb);
  on('q','input', e=>{ state.q=e.target.value; setParam('q', state.q); });
  ['loc','day','time','commit','type'].forEach(k=>{
    on(k,'change', e=>{ state[k]=e.target.value; setParam(k, state[k]); });
  });
  on('disable','change', e=>{ state.disabled = e.target.checked; setParam('nofilters', state.disabled ? '1' : ''); });
}
bindFilterEvents();

// ---------- Active filter count ----------
function activeCount(){
  if(state.disabled) return 0;
  return ['q','loc','day','time','commit','type'].filter(k=>state[k]).length;
}
function updateActiveCount(){
  const n = activeCount();
  document.getElementById('activeCount').textContent = n ? `(${n} active)` : '';
}

// ---------- Drawer behaviour ----------
const drawer = document.getElementById('drawer');
const back   = document.getElementById('drawerBack');
document.getElementById('openDrawer').onclick = ()=>{
  syncControls();
  drawer.classList.add('show'); back.classList.add('show');
};
document.getElementById('closeDrawer').onclick = ()=>{
  drawer.classList.remove('show'); back.classList.remove('show');
};
document.getElementById('applyDrawer').onclick = ()=>{
  drawer.classList.remove('show'); back.classList.remove('show');
  render();
};
document.getElementById('reset').onclick = ()=>{
  ['q','loc','day','time','commit','type'].forEach(k=>{ state[k]=''; setParam(k,''); });
  state.disabled=false; setParam('nofilters','');
  syncControls();
  render();
};

// ---------- Helpers ----------
function passFilters(p){
  if(state.disabled) return true;
  if(state.q){
    const hay = `${p.title} ${p.subtitle} ${p.venue} ${p.type}`.toLowerCase();
    if(!hay.includes(state.q.toLowerCase())) return false;
  }
  if(state.loc && p.location !== state.loc) return false;
  if(state.day && !(p.days||[]).includes(state.day)) return false;
  if(state.time && !(p.times||[]).includes(state.time)) return false;
  if(state.commit && p.commitment !== state.commit) return false;
  if(state.type && p.type !== state.type) return false;
  return true;
}

// ---------- Rendering ----------
function render(){
  updateActiveCount();
  const list = document.getElementById('list');
  list.innerHTML = '';

  const items = PLANS.filter(passFilters);
  if(items.length === 0){
    const empty = document.createElement('div');
    empty.className = 'card glass';
    empty.innerHTML = `<h3>No matching plans</h3><p class="k">Try clearing a filter or disable filters.</p>`;
    list.appendChild(empty);
  } else {
    items.forEach(p=>list.appendChild(planCard(p)));
  }
  list.appendChild(ownPlanCard());
  list.appendChild(notInterestedCard());
}

function planCard(p){
  const c = document.createElement('div');
  c.className = 'card glass';
  const timeBadge = (p.times||[]).join(' / ') || 'Any time';
  const dayBadge  = (p.days||[]).join(' / ') || 'Any day';
  c.innerHTML = `
    <div class="badges">
      <span class="badge">${p.location}</span>
      <span class="badge">${p.type}</span>
      <span class="badge">${p.commitment}</span>
    </div>
    <h3>${p.title}</h3>
    <div class="k">${p.subtitle}</div>
    <div class="k"><strong>Venue:</strong> ${p.venue}</div>
    <div class="k"><strong>When:</strong> ${dayBadge} â€¢ ${timeBadge}</div>
    <div class="cta">
      ${p.url?`<a class="inline" href="${p.url}" target="_blank" rel="noopener">More details</a>`:''}
      <button class="btn" data-confirm="${p.id}">Confirm</button>
    </div>
  `;
  setTimeout(()=>{ c.querySelector('button[data-confirm]').onclick = ()=> openPick(p.id); },0);
  return c;
}

function ownPlanCard(){
  const c = document.createElement('div');
  c.className = 'card glass';
  c.innerHTML = `
    <div class="badges"><span class="badge">Custom</span></div>
    <h3>Make your own plan</h3>
    <input id="ownPlanInput" type="text" placeholder="e.g., India Gate stroll + coffee at CP"/>
    <div class="cta"><button class="btn" id="ownConfirm">Confirm</button></div>
  `;
  setTimeout(()=>{
    document.getElementById('ownConfirm').onclick = ()=>{
      const txt = (document.getElementById('ownPlanInput').value||'').trim();
      openPick(OWN_ID, txt);
    };
  },0);
  return c;
}

function notInterestedCard(){
  const c = document.createElement('div');
  c.className = 'card glass';
  c.innerHTML = `
    <div class="badges"><span class="badge">Skip</span></div>
    <h3>Not interested</h3>
    <p class="k">Lovely effort â€” I'm going to pass this time.</p>
    <div class="cta"><button class="btn ghost" id="niBtn">Send response</button></div>
  `;
  setTimeout(()=>{
    document.getElementById('niBtn').onclick = ()=>{
      openPick(NI_ID, 'Not interested');
    };
  },0);
  return c;
}

// Copy filter link (header)
document.getElementById('copyLink').onclick = ()=>{
  navigator.clipboard.writeText(location.href)
    .then(()=>alert('Filter link copied!'))
    .catch(()=>alert('Could not copy. Please copy from address bar.'));
};

// ---------- Confirm popover ----------
const pop = document.getElementById('pop');
const withMeal = document.getElementById('withMeal');
const customPlan = document.getElementById('customPlan');
let selected = '';

function openPick(id,txt=''){
  selected = id;
  const plan = PLANS.find(p=>p.id===id);
  document.getElementById('pop-title').textContent = `Confirm: ${plan?plan.title:(id===OWN_ID? 'Your plan' : 'Selection')}`;
  withMeal.checked = false;
  customPlan.value = (id===OWN_ID)?(txt||''): (id===NI_ID? 'Not interested' : '');
  pop.classList.add('show');
}
document.getElementById('cancelPop').onclick = ()=> pop.classList.remove('show');

function selectionUrl(planId, meal, ownText){
  const p = new URLSearchParams(location.search);
  p.set('plan', planId);
  if(meal) p.set('meal','with'); else p.delete('meal');
  if(ownText) p.set('own', ownText); else p.delete('own');
  return `${location.origin}${location.pathname}?${p.toString()}`;
}

function shareSelection(via){
  const meal = withMeal.checked ? 'with' : '';
  const ownText = (customPlan.value||'').trim();
  const link = selectionUrl(selected, meal, ownText);
  const plan = PLANS.find(p=>p.id===selected);
  const title = plan ? plan.title : (selected===OWN_ID ? (ownText||'Custom plan') : 'Not interested');
  const msg = `OP Dashboard choice:\n${title}${meal?' (with meal)':''}${ownText?`\nNote: ${ownText}`:''}\n${link}`;

  if(via==='wa'){
    window.open(`https://wa.me/${OWNER_PHONE}?text=${encodeURIComponent(msg)}`,'_blank');
  } else {
    navigator.clipboard.writeText(msg)
      .then(()=>alert('Choice copied!'))
      .catch(()=>alert('Could not copy. Please copy from address bar.'));
  }
  pop.classList.remove('show');
}

document.getElementById('copyChoice').onclick = ()=> shareSelection('copy');
document.getElementById('waChoice').onclick   = ()=> shareSelection('wa');

// ---------- Initial mount ----------
function init(){
  syncControls();
  render();
}
init();
</script>
</body>
</html>
