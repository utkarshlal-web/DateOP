<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OP Dashboard</title>
  <style>
    :root{
      --bg:#fbfbfd; --panel:#ffffff; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --accent:#2563eb; --border: rgba(15, 23, 42, .12);
      --backdrop: rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);
      color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    header{padding:16px 16px 8px; display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    h1{margin:0;font-size:22px;font-weight:800}
    header p{margin:0;color:var(--muted);flex:1 1 100%}
    .top-actions{margin-left:auto;display:flex;gap:8px}
    .btn{background:var(--accent);border:none;color:#fff;border-radius:10px;padding:9px 12px;font-weight:700;cursor:pointer}
    .btn.ghost{background:#e5e7eb;color:#111827;border:1px solid var(--border)}
    .wrap{display:grid;grid-template-columns:320px 1fr;gap:18px;padding:0 16px 20px}
    @media (max-width:900px){.wrap{grid-template-columns:1fr}}

    /* Sidebar panel (desktop) */
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;position:sticky;top:12px;height:max-content;box-shadow:0 8px 24px rgba(2,8,23,.05)}
    .panel h2{margin:6px 6px 10px;font-size:13px;text-transform:uppercase;color:var(--muted);letter-spacing:.12em}
    .filters{display:grid;gap:10px}
    .field{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px}
    .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    .field select,.field input[type="text"]{
      width:100%;background:#f8fafc;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:10px
    }
    .toggle{display:flex;align-items:center;gap:8px;font-size:14px;color:#111827}
    .toggle input{transform:scale(1.1)}

    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn.secondary{background:#e5e7eb;color:#111827;border:1px solid var(--border)}
    .btn.neutral{background:#f3f4f6;color:#111827;border:1px solid var(--border)}

    /* Card grid */
    .list{display:grid;grid-template-columns:repeat(2,minmax(280px,1fr));gap:14px}
    @media (max-width:1100px){.list{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;display:flex;gap:10px;flex-direction:column;box-shadow:0 8px 24px rgba(2,8,23,.05)}
    .card h3{margin:0 0 6px;font-size:18px}
    .k{color:var(--muted)}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px}
    .badge{background:#f3f4f6;border:1px solid var(--border);color:#374151;padding:4px 8px;border-radius:999px;font-size:12px}
    .cta{margin-top:6px;display:flex;gap:8px;flex-wrap:wrap}
    a.inline{color:#1d4ed8;text-decoration:none}

    /* Mobile drawer for filters */
    .drawer-back{display:none}
    @media (max-width:900px){
      .sidebar-col{display:none} /* hide fixed sidebar */
      .drawer-back{position:fixed;inset:0;background:var(--backdrop);display:none;z-index:20}
      .drawer{position:fixed;left:0;right:0;top:0;background:var(--panel);border-bottom:1px solid var(--border);
              border-radius:0 0 16px 16px; padding:12px; box-shadow:0 12px 32px rgba(2,8,23,.2); transform:translateY(-110%); transition:transform .25s ease; z-index:21}
      .drawer.show{transform:translateY(0)}
      .drawer .actions{position:sticky;bottom:0;background:var(--panel);padding-top:8px}
    }

    /* Popover */
    .popover{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--backdrop);z-index:30}
    .popover.show{display:flex}
    .sheet{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;max-width:520px;width:92%}
    .sheet h4{margin:0 0 8px}
    .row{display:flex;gap:10px;align-items:center;margin:8px 0}
    .row input[type="text"]{flex:1;background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:8px}
 body {
  margin: 0;
  font: 16px/1.55 system-ui, sans-serif;
  color: var(--ink);
  background: linear-gradient(to top, #a8e6a1 0%, #d6f5d6 50%, #f5fff5 100%);
  background-attachment: fixed;
}

/* subtle rolling hills */
body::before {
  content: "";
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  background: radial-gradient(circle at 20% 100%, #6fbf73 200px, transparent 201px),
              radial-gradient(circle at 80% 100%, #7fcf85 200px, transparent 201px);
  background-repeat: no-repeat;
  background-size: 50% 100%, 50% 100%;
  z-index: -2;
}

/* panda illustration */
body::after {
  content: "";
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 120px;
  height: 120px;
  background: url('https://upload.wikimedia.org/wikipedia/commons/0/0f/Giant_Panda_vector.svg') no-repeat center/contain;
  opacity: 0.9;
  z-index: -1;
}
  </style>
</head>
<body>
  <header>
    <h1>OP Dashboard</h1>
    <p><em>I figure you're familiar with dashboards, so this should be easy! Would you like to go out with me?</em></p>
    <div class="top-actions">
      <button id="openDrawer" class="btn">Filters <span id="activeCount" style="font-weight:600;"></span></button>
      <button id="copyLink" class="btn ghost">Copy filter link</button>
    </div>
  </header>

  <div class="wrap">
    <!-- Desktop sidebar -->
    <aside class="panel sidebar-col">
      <h2>Filters</h2>
      <div class="filters" id="filtersDesktop"></div>
    </aside>

    <main>
      <div id="list" class="list"></div>
    </main>
  </div>

  <!-- Mobile drawer -->
  <div class="drawer-back" id="drawerBack"></div>
  <div class="drawer" id="drawer">
    <div class="filters" id="filtersMobile"></div>
    <div class="actions">
      <button class="btn" id="applyDrawer">Apply</button>
      <button class="btn neutral" id="closeDrawer">Close</button>
      <button class="btn secondary" id="resetMobile">Reset</button>
    </div>
  </div>

  <!-- Confirm popover -->
  <div id="pop" class="popover">
    <div class="sheet">
      <h4 id="pop-title">Confirm your pick</h4>
      <div class="row"><input type="checkbox" id="withMeal" /><label for="withMeal">With meal</label></div>
      <div class="row"><input id="customPlan" type="text" placeholder="Add a note or your own plan (optional)"/></div>
      <div class="actions">
        <button class="btn" id="copyChoice">Copy link</button>
        <button class="btn secondary" id="waChoice">WhatsApp</button>
        <button class="btn secondary" id="cancelPop">Cancel</button>
      </div>
    </div>
  </div>

<script>
// ---------- Owner contact ----------
const OWNER_PHONE = '919838006777'; // WhatsApp number only

// ---------- Plans (longer, date-friendly durations) ----------
const PLANS = [
  {
    id:'begum',
    title:'Badass Begum: Women & Architecture in Old Delhi',
    subtitle:'Heritage walk',
    type:'Culture',
    url:'https://www.district.in/events/badass-begum-women-architecture-in-old-delhi-aug30-2025-buy-tickets',
    venue:'Old Delhi',location:'Central',
    days:['Saturday','Weekend'],times:['Morning'],
    commitment:'3–4 hrs'
  },
  {
    id:'siri',
    title:'Badminton / Pickleball at Siri Fort',
    subtitle:'Court session',
    type:'Sport',
    url:'#',
    venue:'Siri Fort Sports Complex',location:'South',
    days:['Weekday','Weekend'],times:['Morning','Evening'],
    commitment:'2–3 hrs'
  },
  {
    id:'sloss',
    title:'Daniel Sloss: The New Show',
    subtitle:'Stand-up (BookMyShow)',
    type:'Comedy',
    url:'https://in.bookmyshow.com',
    venue:'South Delhi (see BMS for exact venue)',location:'South',
    days:['Weekday','Weekend'],times:['Evening','Night'],
    commitment:'3–4 hrs'
  },
  {
    id:'karaoke',
    title:'Karaoke @ Garage Delhi',
    subtitle:'Tue / Thu nights',
    type:'Music',
    url:'https://www.instagram.com/garageinc.delhi/?hl=en',
    venue:'Garage Delhi',location:'Central',
    days:['Tuesday','Thursday','Weekday'],times:['Evening','Night'],
    commitment:'3–4 hrs'
  },
  {
    id:'openmic',
    title:'Saturday Open Mic – Comedy • Poetry • Storytelling • Music',
    subtitle:'District.in',
    type:'Open Mic',
    url:'https://www.district.in/events/comedy-poetry-storytelling-music-saturday-open-mic-delhi-nov30-2024-buy-tickets',
    venue:'Delhi',location:'Central',
    days:['Saturday','Weekend'],times:['Evening'],
    commitment:'3–4 hrs'
  },
  {
    id:'escapecp',
    title:'Escape Room – The Hidden Hour (Connaught Place)',
    subtitle:'Solve clues, beat the clock',
    type:'Game',
    url:'https://www.thehiddenhour.com/delhi/connaught-place',
    venue:'Connaught Place',location:'Central',
    days:['Weekday','Weekend'],times:['Afternoon','Evening'],
    commitment:'2–3 hrs'
  },
  {
    id:'escapesouth',
    title:'Escape Room – The Hidden Hour (South Delhi)',
    subtitle:'Pick a theme & crack codes',
    type:'Game',
    url:'https://www.thehiddenhour.com/delhi/connaught-place', /* replace if you have a distinct south link */
    venue:'South Delhi',location:'South',
    days:['Weekday','Weekend'],times:['Afternoon','Evening'],
    commitment:'2–3 hrs'
  }
];

const OWN_ID='ownplan'; const NI_ID='notinterested';
  // ---------- URL state ----------
const params = new URLSearchParams(location.search);
const state = {
  q: params.get('q') || '',
  loc: params.get('loc') || '',
  day: params.get('day') || '',
  time: params.get('time') || '',
  commit: params.get('commit') || '',
  type: params.get('type') || '',
  disabled: params.get('nofilters') === '1', // disable filters
  plan: params.get('plan') || '',
  meal: params.get('meal') || '',
  own: params.get('own') || ''
};

function setParam(k,v){
  const p = new URLSearchParams(location.search);
  if(v || v===0) p.set(k,v); else p.delete(k);
  const url = `${location.pathname}?${p.toString()}`;
  history.replaceState(null,'', url.endsWith('?')?url.slice(0,-1):url);
}

// ---------- Build filter DOM (once) ----------
function filterFormHTML(prefix=''){
  return `
    <div class="field">
      <label for="${prefix}q">Search</label>
      <input id="${prefix}q" type="text" placeholder="Search title, venue…" />
    </div>
    <div class="field">
      <label for="${prefix}loc">Location</label>
      <select id="${prefix}loc">
        <option value="">Any</option>
        <option value="South">South</option>
        <option value="Central">Central</option>
        <option value="North">North</option>
      </select>
    </div>
    <div class="field">
      <label for="${prefix}day">Day</label>
      <select id="${prefix}day">
        <option value="">Any</option>
        <option>Weekday</option>
        <option>Weekend</option>
        <option>Tuesday</option>
        <option>Thursday</option>
        <option>Saturday</option>
      </select>
    </div>
    <div class="field">
      <label for="${prefix}time">Time of day</label>
      <select id="${prefix}time">
        <option value="">Any</option>
        <option>Morning</option>
        <option>Afternoon</option>
        <option>Evening</option>
        <option>Night</option>
      </select>
    </div>
    <div class="field">
      <label for="${prefix}commit">Time commitment</label>
      <select id="${prefix}commit">
        <option value="">Any</option>
        <option>2–3 hrs</option>
        <option>3–4 hrs</option>
        <option>Half-day</option>
      </select>
    </div>
    <div class="field">
      <label for="${prefix}type">Type</label>
      <select id="${prefix}type">
        <option value="">Any</option>
        <option>Culture</option>
        <option>Sport</option>
        <option>Comedy</option>
        <option>Music</option>
        <option>Open Mic</option>
        <option>Game</option>
      </select>
    </div>
    <div class="field toggle">
      <input id="${prefix}disable" type="checkbox" />
      <label for="${prefix}disable">Disable filters</label>
    </div>
    <div class="actions ${prefix?'':'desktop-actions'}">
      ${prefix?'':'<button class="btn secondary" id="reset">Reset</button>'}
    </div>
  `;
}

document.getElementById('filtersDesktop').innerHTML = filterFormHTML('');
document.getElementById('filtersMobile').innerHTML  = filterFormHTML('m_');

function syncFilterControls(prefix=''){
  document.getElementById(`${prefix}q`).value = state.q;
  document.getElementById(`${prefix}loc`).value = state.loc;
  document.getElementById(`${prefix}day`).value = state.day;
  document.getElementById(`${prefix}time`).value = state.time;
  document.getElementById(`${prefix}commit`).value = state.commit;
  document.getElementById(`${prefix}type`).value = state.type;
  document.getElementById(`${prefix}disable`).checked = state.disabled;
}

function bindFilterEvents(prefix='', live=false){
  const evt = (id, event, cb)=>document.getElementById(`${prefix}${id}`).addEventListener(event, cb);
  evt('q', live?'input':'change', e=>{ state.q=e.target.value; setParam('q', state.q); if(live) render(); });
  ['loc','day','time','commit','type'].forEach(k=>{
    evt(k, 'change', e=>{ state[k]=e.target.value; setParam(k, state[k]); if(live) render(); });
  });
  evt('disable','change', e=>{
    state.disabled = e.target.checked; setParam('nofilters', state.disabled ? '1' : '');
    render();
  });
}

// desktop: live update; mobile: queued until Apply
bindFilterEvents('', true);
bindFilterEvents('m_', false);

// ---------- Active filter count ----------
function activeCount(){
  if(state.disabled) return 0;
  return ['q','loc','day','time','commit','type'].filter(k=>state[k]).length;
}
function updateActiveCount(){
  const n = activeCount();
  document.getElementById('activeCount').textContent = n ? `(${n} active)` : '';
}

// ---------- Drawer behaviour ----------
const drawer = document.getElementById('drawer');
const back   = document.getElementById('drawerBack');
document.getElementById('openDrawer').onclick = ()=>{
  // copy desktop values into mobile controls
  syncFilterControls('m_');
  drawer.classList.add('show'); back.style.display='block';
};
document.getElementById('closeDrawer').onclick = ()=>{
  drawer.classList.remove('show'); back.style.display='none';
};
document.getElementById('applyDrawer').onclick = ()=>{
  // read mobile values into state + URL
  ['q','loc','day','time','commit','type'].forEach(k=>{
    const v = document.getElementById('m_'+k).value;
    state[k] = v; setParam(k, v);
  });
  state.disabled = document.getElementById('m_disable').checked;
  setParam('nofilters', state.disabled ? '1' : '');
  render();
  drawer.classList.remove('show'); back.style.display='none';
};
document.getElementById('resetMobile').onclick = ()=>{
  ['q','loc','day','time','commit','type'].forEach(k=>document.getElementById('m_'+k).value='');
  document.getElementById('m_disable').checked=false;
};

// ---------- Helpers ----------
function passFilters(p){
  if(state.disabled) return true;
  if(state.q){
    const hay = `${p.title} ${p.subtitle} ${p.venue} ${p.type}`.toLowerCase();
    if(!hay.includes(state.q.toLowerCase())) return false;
  }
  if(state.loc && p.location !== state.loc) return false;
  if(state.day && !(p.days||[]).includes(state.day)) return false;
  if(state.time && !(p.times||[]).includes(state.time)) return false;
  if(state.commit && p.commitment !== state.commit) return false;
  if(state.type && p.type !== state.type) return false;
  return true;
}

// ---------- Rendering ----------
function render(){
  // sync both UIs
  syncFilterControls(''); syncFilterControls('m_');
  updateActiveCount();

  const list = document.getElementById('list');
  list.innerHTML = '';

  const items = PLANS.filter(passFilters);
  if(items.length === 0){
    const empty = document.createElement('div');
    empty.className = 'card';
    empty.innerHTML = `<h3>No matching plans</h3><p class="k">Try clearing a filter or disable filters.</p>`;
    list.appendChild(empty);
  } else {
    items.forEach(p=>list.appendChild(planCard(p)));
  }
  list.appendChild(ownPlanCard());
  list.appendChild(notInterestedCard());
}

function planCard(p){
  const c = document.createElement('div');
  c.className = 'card';
  const timeBadge = (p.times||[]).join(' / ') || 'Any time';
  const dayBadge  = (p.days||[]).join(' / ') || 'Any day';
  c.innerHTML = `
    <div class="badges">
      <span class="badge">${p.location}</span>
      <span class="badge">${p.type}</span>
      <span class="badge">${p.commitment}</span>
    </div>
    <h3>${p.title}</h3>
    <div class="k">${p.subtitle}</div>
    <div class="k"><strong>Venue:</strong> ${p.venue}</div>
    <div class="k"><strong>When:</strong> ${dayBadge} • ${timeBadge}</div>
    <div class="cta">
      ${p.url?`<a class="inline" href="${p.url}" target="_blank" rel="noopener">More details</a>`:''}
      <button class="btn" data-confirm="${p.id}">Confirm</button>
    </div>
  `;
  setTimeout(()=>{ c.querySelector('button[data-confirm]').onclick = ()=> openPick(p.id); },0);
  return c;
}

function ownPlanCard(){
  const c = document.createElement('div');
  c.className = 'card';
  c.innerHTML = `
    <div class="badges"><span class="badge">Custom</span></div>
    <h3>Make your own plan</h3>
    <input id="ownPlanInput" type="text" placeholder="e.g., India Gate stroll + coffee at CP"/>
    <div class="cta"><button class="btn" id="ownConfirm">Confirm</button></div>
  `;
  setTimeout(()=>{
    document.getElementById('ownConfirm').onclick = ()=>{
      const txt = (document.getElementById('ownPlanInput').value||'').trim();
      openPick(OWN_ID, txt);
    };
  },0);
  return c;
}

function notInterestedCard(){
  const c = document.createElement('div');
  c.className = 'card';
  c.innerHTML = `
    <div class="badges"><span class="badge">Skip</span></div>
    <h3>Not interested</h3>
    <p class="k">Lovely effort — I'm going to pass this time.</p>
    <div class="cta"><button class="btn secondary" id="niBtn">Send response</button></div>
  `;
  setTimeout(()=>{
    document.getElementById('niBtn').onclick = ()=>{
      openPick(NI_ID, 'Not interested');
    };
  },0);
  return c;
}

// Copy filter link
document.getElementById('copyLink').onclick = ()=>{
  navigator.clipboard.writeText(location.href)
    .then(()=>alert('Filter link copied!'))
    .catch(()=>alert('Could not copy. Please copy from address bar.'));
};

// ---------- Confirm popover ----------
const pop = document.getElementById('pop');
const withMeal = document.getElementById('withMeal');
const customPlan = document.getElementById('customPlan');
let selected = '';

function openPick(id,txt=''){
  selected = id;
  const plan = PLANS.find(p=>p.id===id);
  document.getElementById('pop-title').textContent = `Confirm: ${plan?plan.title:(id===OWN_ID? 'Your plan' : 'Selection')}`;
  withMeal.checked = false;
  customPlan.value = (id===OWN_ID)?(txt||''): (id===NI_ID? 'Not interested' : '');
  pop.classList.add('show');
}
document.getElementById('cancelPop').onclick = ()=> pop.classList.remove('show');

function selectionUrl(planId, meal, ownText){
  const p = new URLSearchParams(location.search);
  p.set('plan', planId);
  if(meal) p.set('meal','with'); else p.delete('meal');
  if(ownText) p.set('own', ownText); else p.delete('own');
  return `${location.origin}${location.pathname}?${p.toString()}`;
}

function shareSelection(via){
  const meal = withMeal.checked ? 'with' : '';
  const ownText = (customPlan.value||'').trim();
  const link = selectionUrl(selected, meal, ownText);
  const plan = PLANS.find(p=>p.id===selected);
  const title = plan ? plan.title : (selected===OWN_ID ? (ownText||'Custom plan') : 'Not interested');
  const msg = `OP Dashboard choice:\n${title}${meal?' (with meal)':''}${ownText?`\nNote: ${ownText}`:''}\n${link}`;

  if(via==='wa'){
    window.open(`https://wa.me/${OWNER_PHONE}?text=${encodeURIComponent(msg)}`,'_blank');
  } else {
    navigator.clipboard.writeText(msg)
      .then(()=>alert('Choice copied!'))
      .catch(()=>alert('Could not copy. Please copy from address bar.'));
  }
  pop.classList.remove('show');
}

document.getElementById('copyChoice').onclick = ()=> shareSelection('copy');
document.getElementById('waChoice').onclick   = ()=> shareSelection('wa');

// ---------- Initial mount ----------
function init(){
  // sync desktop controls to state and render
  syncFilterControls(''); syncFilterControls('m_');
  // desktop reset button
  const resetBtn = document.getElementById('reset');
  if(resetBtn){
    resetBtn.onclick = ()=>{
      ['q','loc','day','time','commit','type'].forEach(k=>{ state[k]=''; setParam(k,''); });
      state.disabled=false; setParam('nofilters','');
      render();
    };
  }
  render();
}
init();
</script>
</body>
</html>
